function X_regul=regularisation(d,nb_part,coef_hopt,X,choix_noyau)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% on regularise la densite "somme de dirac" par une estimation lisse% par noyaux% choix_noyau=1 : noyau Epanechnikov% choix_noyau=2 : noyau Gaussien% coef_hopt : coefficient qui evite de sur-lisser la densite% X : nuage de particules% nb_part : nb de particules%  X_regul : nuage de particules regularisees%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% calcul de la largeur de bande et des tirages de noyauif choix_noyau==1 	cd=pi^(d/2)/gamma(d/2+1);% volume de la sphere unite	hopt=coef_hopt*(8*(d+4)*(2*sqrt(pi))^d/cd)^(1/(d+4))/nb_part^(1/(d+4));	Z=gene_epanech(d,nb_part);endif choix_noyau==2	hopt=coef_hopt*(4/(d+2))^(1/(d+4))/nb_part^(1/(d+4));	Z=randn(d,nb_part);end% regularisation apres blanchiementpoids=ones(1,nb_part)/nb_part;[moy,mat_cov] = MoyCovPond(d,nb_part,X,poids);A=chol(mat_cov'+1.e-30*eye(d,d));% on doit avoir : A'*A=mat_cov;X_regul=X+hopt*A'*Z;